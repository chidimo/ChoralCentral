{% extends "choralcentral_base.html" %}
{% block title %}{{ siteuser.screen_name }}'s library{% endblock title %}
{% block introduction %}{% endblock introduction %}

{% block content_content %}

<div class='container siteuser-detail-heading'>
    <div class='row'>
        <div class='col-sm-12'>
            <span class='h5 float-left'>
                {% if user == siteuser.user %}
                    Dashboard
                {% else %}
                    About {{ siteuser.screen_name }}
                {% endif %}
            </span>
        </div>
    </div>
</div>

{% if user == siteuser.user %}
    <div class="administer-account">
        <div class="btn-group">
            <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                My account
            </button>
            <div class="dropdown-menu">
                <a class="dropdown-item" href="{% url 'siteuser:edit' siteuser.pk siteuser.slug %}">Edit profile</a>
                    <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'siteuser:change_password' %}">Change password</a>
                    <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'siteuser:reset_password' %}">Reset password</a>
            </div>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-primary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Create new
            </button>
            <div class="dropdown-menu">
                <a class="dropdown-item" href="{% url 'song:new' %}">Song</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'blog:new' %}">Blog post</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'request:new' %}">Request</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'siteuser:new_group' %}">Group</a>
            </div>
        </div>
    </div>
<hr>
{% endif %}

<div class='col-sm-12 about-accordion'>
    <div id="accordion">
        <h5>
            <a href="#" data-toggle="collapse" data-target="#About" aria-expanded="false" aria-controls="#About">
                About
            </a>
        </h5>
        <div id="About" class="collapse" data-parent="accordion">

            <div>
                <span class="h6">First name:</span>
                <span class="h6">{{ siteuser.first_name }}</span>
            </div>

            <div>
                <span class="h6">Last name:</span>
                <span class="h6">{{ siteuser.last_name }}</span>
            </div>

            <div>
                <span class="h6">Email:</span>
                <span class="h6"><a href="mailto:{{ siteuser.user.email }}">{{ siteuser.user.email }}</a></span>
            </div>

            <div>
                <span class="h6">Roles:</span>
                <span class="h6">
                    {% for role in siteuser.roles.all %}
                        <a href='#' title='See other {{ role.role|title }}'>{{ role.role|title }}</a>
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}</span>
            </div>

            <div>
                <span class="h6">Location:</span>
                <span class="h6"><a href='#' title='See others from {{ siteuser.location }}'>{{ siteuser.location }}</a></span>
            </div>
            <div>
                <span class="h6">Last seen:</span>
                <span class="h6">{{ user.siteuser.user.last_login }}</span>
            </div>
            <div>
                <span class="h6">Member since:</span>
                <span class="h6">{{ siteuser.created }}</span>
            </div>
            <div>
                <span class="h6">Comments:</span>
                <span class="h6"><a href="{% url 'siteuser:comments' siteuser.pk siteuser.slug %}">{{ siteuser.comment_set.count }}</a></span>
            </div>
        </div>
    </div>
</div>


<div class='col-sm-12 about-accordion'>
<div id="accordion">
    <h5>
        <a href="#" data-toggle="collapse" data-target="#Songs" aria-expanded="false" aria-controls="#Songs">
            Songs
        </a>
    </h5>
    <div id="Songs" class="collapse" data-parent="accordion">
        <div class="table-responsive">
        <table class="table">
            <thead class="thead-dark">
                <caption>Songs</caption>
                <tr>
                    <th>Title</th>
                    <th>Popularity</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
                <tbody>
                {% for song in siteuser.song_set.all %}
                    {% if song.publish %}
                        <tr>
                    {% else %}
                        {% if user == siteuser.user %}
                            <tr class='text-danger'>
                        {% else %}
                            <tr class='d-none'>
                        {% endif %}
                    {% endif %}
                            <td><a href="{% url 'song:detail' song.pk song.slug %}">{{ song.title }}</a></td>
                            <td>{{ song.like_count }}</td>
                            <td>{% if song.publish %}Public{% else %}Private{% endif %}</td>
                            <td>
                                {% if request.user == siteuser.user %}
                                    <a href="{% url 'song:edit' song.pk song.slug %}" title='Edit'><i class="fas fa-edit"></i></a> |
                                    <a href="{% url 'song:delete' song.pk %}" title='Delete {{ song.title }}'><i class="fas fa-trash"></i></a> |
                                {% endif %}
                            </td>
                        </tr>
                {% empty %}
                    <p>No song to display</p>
                {% endfor %}
                </tbody>
        </table>
    </div>
    </div>
</div>

</div>

<div class='col-sm-12 about-accordion'>
<div id="accordion">
    <h5>
        <a href="#" data-toggle="collapse" data-target="#blogPosts" aria-expanded="false" aria-controls="#blogPosts">
            Blog posts
        </a>
    </h5>
    <div id="blogPosts" class="collapse" data-parent="accordion">
        <div class="table-responsive">
        <table class="table">
            <thead class="thead-dark">
                <caption>Blog posts</caption>
                <tr>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
                <tbody>
                {% for post in siteuser.post_set.all %}
                    {% if post.publish %}
                        <tr>
                    {% else %}
                        {% if user == siteuser.user %}
                            <tr class='text-danger'>
                        {% else %}
                            <tr class='d-none'>
                        {% endif %}
                    {% endif %}
                        <td><a href="{% url 'blog:detail' post.pk post.slug %}">{{ post.title }}</a></td>
                        <td>{% if post.publish %}Public{% else %}Private{% endif %}</td>

                        <td>
                            {% if user == siteuser.user %}
                                <a href="{% url 'blog:edit' post.pk %}"><i class="fas fa-edit"></i></a> |
                                <a href="#"><i class="fas fa-trash"></i></a>
                            {% endif %}
                        </td>

                    </td>
                {% empty %}
                    <p>No posts to display</p>
                {% endfor %}
                </tbody>
        </table>
    </div>
    </div>
</div>

</div>

<div class='col-sm-12 about-accordion'>
<div id="accordion">
    <h5>
        <a href="#" data-toggle="collapse" data-target="#Requests" aria-expanded="false" aria-controls="#Requests">
            Requests
        </a>
    </h5>
    <div id="Requests" class="collapse" data-parent="accordion">
        <div class="table-responsive">
        <table class="table">
            <thead class="thead-dark">
                <caption>My blog posts</caption>
                <tr>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
                <tbody>
                {% for request in siteuser.request_set.all %}
                    <tr>
                        {% if request.status == True %}
                            <td><a href="{% url 'request:detail' request.pk request.slug %}">{{ request }}</a></td>
                            <td>{{ request.status }}</td>
                        {% else %}
                            <td><a "text-danger" href="{% url 'request:detail' request.pk request.slug %}">{{ request }}</a></td>
                            <td class="text-danger">{{ request.status }}</td>
                        {% endif %}
                        <td>
                            <a href="{% url 'request:edit' request.pk %}"><i class="fas fa-edit"></i></a>
                        </td>
                    </tr>
                {% empty %}
                    <p>No request to display</p>
                {% endfor %}
                </tbody>
        </table>
    </div>
    </div>
</div>

</div>

<div class='col-sm-12 about-accordion'>
    <div id="accordion">
        <h5>
            <a href="#" data-toggle="collapse" data-target="#Authors" aria-expanded="false" aria-controls="#Authors">
                Authors
            </a>
        </h5>
        <div id="Authors" class="collapse" data-parent="accordion">
            <div class="table-responsive">
                <table class="table">
                    <thead class="thead-dark">
                        <caption>My authors</caption>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                        <tbody>
                        {% for author in siteuser.author_set.all %}
                            <tr>
                                <td><a href="{% url 'author:detail' author.pk author.slug %}">{{ author }}</a></td>
                                <td>{{ author.author_type|title }}</td>
                                <td><a href="#"><i class="fas fa-edit"></i></a> |
                                <a href="#"><i class="fas fa-trash"></i></a></td>
                            </tr>
                        {% empty %}
                            <p>No author to display</p>
                        {% endfor %}
                        </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock content_content %}

