{% extends "choralcentral_base.html" %}

{% if song %}{% block title %}{{ song }}{% endblock title %} {% endif %}

{% block wrap_filter %}{% endblock wrap_filter %}
{% load song_ttags %}

{% block content_content %}

<div class="container">

    <div class="list-group">
        
            {% if song %}
            <div class="row">
                <div class="col-sm-12">
                    <h2>{{ song.title }}
    
                        {% if song.originator.user == user %}
                            
                                <a href="{% url 'song:edit' song.pk %}"><i class="fa fa-pencil" aria-hidden="true"></i></a>
                                <a href="{% url 'song:delete' song.pk %}"><i class="fa fa-trash" aria-hidden="true"></i></a>
                        {% endif %}
    
                        {% if user.is_authenticated %}
    
                        <!-- like script -->
                        <button class="fa fa-star btn btn-primary" type="submit" id="like" title="{{ song.pk }}" value="Like"></button>
                        
                        <script>
                        $('#like').click(function(){
                            $.ajax({
                                type: "POST",
                                url: "{% url 'song:like_song' %}",
                                data: {'pk': $(this).attr('title'), 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                                dataType: "json",
                                success: function(response) {
                                        alert(response.message);
                                },
                                error: function(rs, e) {
                                        alert(rs.responseText);
                                }
                            }); 
                            })
                        </script>
                    
                        {% else %}
                            <p class="h4"><a href="{% url 'login' %}?next={{ request.path }}">login</a> to give a star</p>
                        {% endif %}
                        <!-- end like script -->
                    </h2>
                </div>
            </div>
    
            <div class="list-group-item list-group-item-action list-group-item-primary">
                <div class="row">
                    <div class="col-sm-3">
                        <p class="h4">For</p>
                        <p>{{ song.voicing }}</p>
                    </div>

                    <div class="col-sm-3">
                        <p class="h4">Performed</p>
                        <p>{{ song.tempo_text }}</p>
                    </div>


                    <div class="col-sm-3">
                        <p class="h4">Tempo</p>
                        <p>{{ song.tempo }}</p>
                    </div>

                    <div class="col-sm-3"><p class="h4">Timing</p>
                        <p>{{ song.bpm }}/{{ song.divisions }}</p>
                    </div>
                </div>
            </div>


            <div class="list-group-item list-group-item-action list-group-item-primary">

                <div class="row">
                    <div class="col-sm-3"><p class="h4">Scripture</p>
                        <p>{{ song.scripture_ref }}</p>
                    </div>

                    <div class="col-sm-3"><p class="h4">Started by</p>
                        <a href="{% url 'siteuser:detail' song.originator.pk %}">{{ song.originator.screen_name }}</a>
                    </div>

                    <div class="col-sm-3"><p class="h4">Started</p>
                        <p>{{ song.created|date:"Y-M-d" }}</p>
                    </div>

                    <div class="col-sm-3"><p class="h4">Composed</p>
                        <p>{{ song.compose_date }}</p>
                    </div>
                </div>
            </div>

            <div class="list-group-item list-group-item-action list-group-item-primary">
                <div class="row">
                    <div class="col-sm-4">
                        <p class="h4">Season(s)</p>
                        <p>{{ song.all_seasons }}</p>
                    </div>

                    <div class="col-sm-4">
                        <p class="h4">Mass Part</p>
                        <p>{{ song.all_masspart }}</p>
                    </div>

                    <div class="col-sm-4">
                        <p class="h4">Authors</p>
                        <p>
                            {% for author in song.authors.all %}
                                <a href="{% url 'author:detail' author.pk %}">{{ author }}</a>{% if not forloop.last %},{% endif %}
                            {% endfor %}
                        </p>
                    </div>
                </div>
            </div>

            <div class="list-group-item list-group-item-action list-group-item-primary">
                <div class="row">
                    <div class="col-sm-12">
                        <h4>Lyrics</h4>
                        {{ song.lyrics|markdown_format }}
                    </div>
                </div>
            </div>
       

            <!-- scores -->
            <div class="list-group-item list-group-item-action list-group-item-primary">
                <div class="row">
                    <div class="col-sm-12">
                        <h4>Scores <a href="{% url 'song-media:sheet_add_song' song.pk %}"><i class="fa fa-plus" aria-hidden="true"></i></a></h4>
                    </div>
                </div>

                {% if song.sheet_set.all %}
                    <table class="table table-responsive-md">
                        <thead class="thead-light">
                            <caption>Uploaded scores</caption>
                            <tr>
                                <th>#</th>
                                <th>Part</th>
                                <th>Notation</th>
                                <th>Uploader</th>
                                <th><i class="fa fa-star" aria-hidden="true"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sheet in song.sheet_set.all %}
                                <tr>
                                    <th>{{ forloop.counter }}</th>
                                    <td><a href="{% url 'song-media:sheet_view' sheet.pk %}" target="blank">{{ sheet.part }}</a></td>
                                    <td>{{ sheet.notation }}</td>
                                    <td><a href="{% url 'siteuser:detail' sheet.uploader.pk %}">{{ sheet.uploader.screen_name }}</a></td>
                                    <td><a href="">{{ sheet.sheet_likes }}</a></td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                <p>No music sheet uploaded for this song</p>
                {% endif %}
            </div><!-- END SHEET -->
    
            <!-- midi -->
            <div class="list-group-item list-group-item-action list-group-item-primary">
                <div class="row">
                    <div class="col-sm-12">
                        <h4>Midi <a href="{% url 'song-media:midi_add_song' song.pk %}"><i class="fa fa-plus"></i></a></h4>
                    </div>
                </div>

                {% if song.midi_set.all %}
                <table class="table table-responsive-md">
                    <thead class="thead-light">
                        <caption>Uploaded midis</caption>
                        <tr>
                            <th>#</th>
                            <th>Part</th>
                            <th>Uploader</th>
                            <th><i class="fa fa-star" aria-hidden="true"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for midi in song.midi_set.all %}
                            <tr>
                                <th>{{ forloop.counter }}</th>
                                <td><a href="{% url 'song-media:play_midiview' midi.pk %}" target="blank">{{ midi.part }}</a></td>
                                <td><a href="{% url 'siteuser:detail' midi.uploader.pk %}">{{ midi.uploader.screen_name }}</a></td>
                                <td><a href="">{{ midi.midi_likes }}</a></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                    <p>No midis uploaded for this song</p>
                {% endif %}
              </div> <!-- END AUDIO -->
    

            <div class="list-group-item list-group-item-action list-group-item-primary">
                <div class="row">
                    <div class="col-sm-12">
                        <h4>Videos <a href="{% url 'song-media:videolink_new_song' song.pk %}"><i class="fa fa-plus"></i></a></h4>
                        {% if song.videolink_set.all %}
                            {% for link in  song.videolink_set.all %}
                                <a href="{{ link.video_link }}" target="_blank">{{ link.video_link }}</a>{% if not forloop.last %} | {% endif %}
                            {% endfor %}
                        {% else %}
                            <p>No video links added for this song</p>
                        {% endif %}
                    </div>
                </div>
            </div> <!-- END VIDEO -->
            {% else %}
                <p>Song does not exist</p>
            {% endif %}
    </div>
</div>
{% endblock content_content %}

{% block wrap_forms %}{% endblock wrap_forms %}
